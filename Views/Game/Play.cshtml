@model GameViewModel

@{
    ViewData["Title"] = "Game";
}

@for(var a = -1; a < Model.Categories[0].Answers.Count(); a++)
{
    <div class='row @(a == -1 ? "text-white" : "")'>
        @for(var c = 0; c < Model.Categories.Count(); c++) {
            <div class="col bg-primary py-5 border border-white rounded">
                <h2 class="text-center">
                    @if (a == -1) {
                        @Model.Categories[c].CategoryTitle
                    } else {
                        if (Model.Categories[c].Answers[a].HasBeenRead == true) {
                            <span class="text-primary">
                                @($"${Model.Categories[c].Answers[a].AnswerValue}")    
                            </span>
                        } else {
                            <a href="#" class="text-warning" data-url='@Url.Action("Index", "Answer", new {id = Model.Categories[c].Answers[a].AnswerId})' data-toggle="modal" data-answerid="@(Model.Categories[c].Answers[a].AnswerId)">
                                @($"${Model.Categories[c].Answers[a].AnswerValue}")
                            </a>
                        }
                    }
                </h2>
            </div>      
        }
    </div>
}

<div id="modal-placeholder"></div>

@section Scripts {
    <script type="text/javascript">
        (function($){
            $(document).ready(function(){
                var connection = new signalR.HubConnectionBuilder()
                    .withUrl('/userhub')
                    .build();

                var $modalPlaceholder = $('#modal-placeholder');
                $modalPlaceholder.on('show.bs.modal', function(e){
                    var answerId = $modalPlaceholder.find('div[data-answerid]').data('answerid');
                    var $answerLink = $(`a[data-answerid="${answerId}"]`);
                    var answerUrl = $modalPlaceholder.find('div[data-answerid]').data('url');
                    $modalPlaceholder.on('hide.bs.modal', function (e) {
                        $.post(answerUrl).done(function(response){
                            $answerLink.removeClass('text-warning');
                            $answerLink.addClass('text-primary');
                            $answerLink.removeAttr('href');
                        });
                    });
                });
            });
        })(jQuery);
    </script>
}